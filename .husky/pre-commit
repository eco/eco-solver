#!/usr/bin/env sh

# Run ESLint and fix issues
pnpm run lint

# Run secret detection
echo "🔍 Scanning for secrets..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)
if [ -n "$STAGED_FILES" ]; then
  if ! npx secretlint $STAGED_FILES; then
    echo "❌ Secret scan failed! Please review the detected secrets."
    echo "💡 Remove secrets from your files or add them to .secretlintrc.json ignoreFiles"
    echo "💡 To skip this check (emergency only): git commit --no-verify"
    exit 1
  fi
fi

echo "✅ Secret scan passed!"
