#!/usr/bin/env sh

# Run ESLint and fix issues
pnpm run lint

# Run secret detection
echo "ğŸ” Scanning for secrets..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)
if [ -n "$STAGED_FILES" ]; then
  if ! npx secretlint $STAGED_FILES; then
    echo "âŒ Secret scan failed! Please review the detected secrets."
    echo "ğŸ’¡ Remove secrets from your files or add them to .secretlintrc.json ignoreFiles"
    echo "ğŸ’¡ To skip this check (emergency only): git commit --no-verify"
    exit 1
  fi
fi

echo "âœ… Secret scan passed!"
